<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SrB Trading</title>
	<link rel="icon" type="imagem/png" href="aperto-de-mao.png" />
    <link href="styles.css" rel="stylesheet">
    
    <script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
    
    
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script type="text/javascript">

//google.charts.load('current', {packages: ['corechart', 'line']});
google.charts.load('current', {'packages':['corechart']});
google.charts.setOnLoadCallback(simula);

function simula() {
	
      var data = new google.visualization.DataTable();
      data.addColumn('number', 'X');
      data.addColumn('number', 'Curva de Capital');
      
  	var y = 0;
	var nOperacoes = parseInt( $("#nOperacoes").val() );	
	var     p = parseFloat( $("#p").val() );
	var risco = parseFloat( $("#risco").val() );
	var    rr = parseFloat( $("#rr").val() );

	var ddMax = 0.0;
	var yMax = 0.0;
	
	for ( var i = 0; i < nOperacoes; i++ ) {
		if ( (100 * Math.random()) < p ){
			y = y + (rr * risco);
		} else {
			y = y - risco;
		}
		
		if (y>yMax){yMax = y;}
		
		if (Math.abs(y-yMax) > ddMax) {ddMax = Math.abs(y-yMax);}
		
		data.addRow([i,y/100.0]);
	}

      var options = {
        hAxis: {
          title: 'Número de Operações',
          titleFontSize: 16,
          titleTextStyle: {color: 'gray'},
          fontName: "Calibri",
          gridlines: {count: 10},
        },
        vAxis: {
          title: 'Rentabilidade Acumulada',
          titleFontSize: 16,
          titleTextStyle: {color: 'gray'},
          fontName: "Calibri",
          format: "0%"
        },
        
        title: 'Curva de Capital \nDrawdown Máximo: ' + ddMax.toFixed(2) + '%', //ddMax.toFixed(2)
        //subtitle: 'Drawdown Máximo: ' + ddMax + '%',
        
        titleTextStyle: {
            color: 'gray',    // any HTML string color ('red', '#cc00cc')
            fontName: 'Calibri', // i.e. 'Times New Roman'
            fontSize: 20, // 12, 18 whatever you want (don't specify px)
            bold: true,    // true or false
            italic: true,   // true of false
            align: 'center',
        },

        chartArea: {left: 100, top: 100, width: '80%', height: '65%'},
      

/*       
         backgroundColor: {
             gradient: {
               // Start color for gradient.
               color1: '#fbf6a7',
               // Finish color for gradient.
               color2: '#33b679',
               // Where on the boundary to start and
               // end the color1/color2 gradient,
               // relative to the upper left corner
               // of the boundary.
               x1: '0%', y1: '0%',
               x2: '100%', y2: '100%',
               // If true, the boundary for x1,
               // y1, x2, and y2 is the box. If
               // false, it's the entire chart.
               useObjectBoundingBoxUnits: true
             },
         },
*/         
/*
         chartArea: {
             'backgroundColor': {
                 'fill': 'yellow',
                 //'opacity': 100,
                 'fillOpacity': 0.1
              },
          },
*/
          backgroundColor: {
              fill: '#fffee0',
              fillOpacity: 1.0 //
          },
          
          /*legend: { position: "top", maxLines: 9, alignment:'start'  },*/
          legend: {position: 'none'},

      };
      
      //var chart = new google.visualization.LineChart(document.getElementById('chart_simulacao'));
      var chart = new google.visualization.AreaChart(document.getElementById('chart_simulacao'));
      chart.draw(data, options);
  //    $("#ddMax").text("O drawdown máximo ocorrido nesta simulação foi de " + ddMax.toFixed(2) + "%");
  
  		calculaDados();
      
    }
    
    
    
    function calculaDados(){
    	var p = parseFloat( $("#p").val() );
    	var risco = parseFloat( $("#risco").val() );
    	var rr = parseFloat( $("#rr").val() ); 
    	
    	var breakEven = 100 * (1.0 / (1.0 + rr) );
    	var edge = p - breakEven;
    	
    	
    	$("#dadosCalculados").text("Breakeven = " + breakEven.toFixed(2) + "%  e Edge = " + edge.toFixed(2) + "%");
    }

</script>

</head>

<body onload=simula()>

<div id="corpo">
	<h1>Simulação Monte Carlo de Sistema de Trading</h1>
	
	<div id="textointrodutorio">
		No momento, o sistema sendo testado de swing trade em Forex tem os seguintes parâmetros:
	    acertividade de 53,33%, payoff de 1,36 e risco médio de 1,45%. Essas estatísticas foram
	    obtidas em 60 operações. Mais detalhes em <a href="http://bit.ly/srbfxlivre" target="_blank">http://bit.ly/srbfxlivre</a>.<p>
	    Por meio dos parâmetros do sistema de trading obtidos por backtesting ou forwarding testing,
	    como os descritos acima, pode-se fazer várias simulações de possíveis históricos (curvas de capital)
	    a fim de se obter características adicionais do sistema, como por exemplo, o drawdown máximo.
	</div>
	
	<div id="textoexplicativo">
		A probabilidade de acertar a operação ou a acertividade é o percentual de operações que terminam no lucro.
		O payoff, ou no jargão do Van Tharp o RR (razão ganho:perda ou Reward:Risk), é a média do ganho das operações vencedoras dividido pela
		média de perda das operações perdedoras. O risco percentual por operação refere-se a quantidade
		de capital que é posto em risco de perda por cada operação. O breakeven é a probabilidade mínima que
		o sistema deve ser para no mínimo "empatar" (não ter prejuízo). O edge é, em um sistema vencedor
		é a diferença entre o percetual de acerto e o breakeven.
	</div>
	
	
	<div id="wrapperDados">
		<table id="tabelaDados">
			<tr>
		  		<td class="tdlabel"><label>Número de Operações:</label></td>
		  		<td><input type="text" id="nOperacoes" name="nOperacoes" value="500"></td> 
		  	</tr>
		  	<tr>
		  		<td class="tdlabel"><label>Probabilidade de Acertar a Operação:</label></td>
		  		<td><input type="text" id="p" name="p" value="53.33"></td> 
		  	</tr>
		  	<tr>
		  		<td class="tdlabel"><label>Razão RR (payoff):</label></td>
		  		<td><input type="text" id="rr" name="rr" value="1.36"></td> 
		  	</tr>
		  	<tr>
		  		<td class="tdlabel"><label>Risco Percentual por Operação:</label></td>
		  		<td><input type="text" id="risco" name="risco" value="1.45"></td> 
		  	</tr>
		</table>
		<div id="dadosCalculados"></div>
		<button id="btnSimular" type="button" class="btn btn-primary buttonsalvarnovo" onclick="simula()">Simular</button>
	</div>
  
  
	<div id="wrapperChart">
	  <div id="chart_simulacao"></div>
  	</div>

	<div id="assinatura">
		Por Sandro Roger Boschetti
	</div>
    
</div> <!-- div corpo -->

</body>
</html>